#makefile for PDF editor
.PHONY: clean pdfedit kernel xpdf kpdf-kde-3.3.2 utils qoutputdevices xpdf_configure install

#make PDF editor - source and documentation
all: pdfedit

# PDF editor
pdfedit: utils kernel xpdf qoutputdevices
	cd gui && qmake && make

# QOutputDevices
qoutputdevices: xpdf config_xpdf_variables
	cd kpdf-kde-3.3.2 && qmake && make staticlib

# Utils
utils: 
	cd utils && make

# Kernel
kernel: xpdf config_xpdf_variables utils
	cd kernel && qmake && make

# XPdf
xpdf: xpdf_configure
	cd xpdf && make

# XPdf configure
xpdf_configure: xpdf/config.status

#if any of the Makefile.in changes, we need to rebuild corresponding Makefile in xpdf -> we rebuild them all to be sure
xpdf/config.status: xpdf/Makefile.in xpdf/xpdf/Makefile.in xpdf/splash/Makefile.in xpdf/goo/Makefile.in xpdf/fofi/Makefile.in
	cd xpdf && ./configure

#parsed variables generated by ./configure from xpdf
config_xpdf_variables: xpdf/config.status
	cat xpdf/config.status | grep s,@[^@,]*@, | sed 's/^s,@\([^@,]*\)@,\([^,]*\),.*/config_xpdf_\1=\2/g' > config_xpdf_variables

# Cleanup
clean:
	cd gui && make clean
	cd kernel && make clean
	cd utils && make clean
	cd xpdf && make clean
	cd kpdf-kde-3.3.2 && make clean

# Installation
install:
	cd gui && make install
