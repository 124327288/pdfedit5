#!/bin/sh

# Check release before actually releasing

#TODO: unpack tarball elsewhere, run checks on unpacked stuff

error=0

#Check completeness of translations

check_trans() {
 all=`grep '<message>' <$1 |wc -l`
 un=`grep 'type="unfinished"' <$1 |wc -l`
 obs=`grep 'type="obsolete"' <$1 |wc -l`
 pct=$((100-100*un/(all-obs)))
 echo "$1 $all messages, $un unfinished, $obs obsolete, $pct% complete"
 if test ! $un -eq 0
 then
  error=1
 fi
}

echo "Checking translations"
cd src/gui/lang
for i in *.ts
do
 check_trans $i
done

# Return results of check

if test $error -eq 0
then
 echo "Everything is OK"
else
 echo "Some errors encountered"
fi

exit $error
